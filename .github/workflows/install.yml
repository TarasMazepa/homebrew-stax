on:
  push:
    branches: [ "main" ]

jobs:
  install:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest, macos-latest, macos-13]
    steps:
      - uses: Homebrew/actions/setup-homebrew@master
      - run: |
          brew install TarasMazepa/stax/stax
          stax doctor

  install-x86:
    runs-on: ubuntu-latest
    container: i386/alpine:latest
    steps:
      - run: |
          apk update
          apk add bash build-base curl file git gzip libc6-compat ncurses ruby ruby-dbm ruby-etc ruby-irb ruby-json sudo
          adduser -D -s /bin/bash linuxbrew
          echo 'linuxbrew ALL=(ALL) NOPASSWD:ALL' >>/etc/sudoers
          su -l linuxbrew
          sh -c "$(curl -fsSL https://raw.githubusercontent.com/Linuxbrew/install/master/install.sh)"
          PATH=$HOME/.linuxbrew/bin:$HOME/.linuxbrew/sbin:$PATH
          brew update
          brew doctor
      - run: |
          brew install TarasMazepa/stax/stax
          stax doctor
